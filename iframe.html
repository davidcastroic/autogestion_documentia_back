<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Prueba de Iframe - Impocali</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }

        header,
        footer {
            margin-bottom: 20px;
            font-weight: bold;
        }

        iframe {
            border: 1px solid #ccc;
            width: 100%;
            height: 800px;
        }

        button {
            margin: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <header>Simulador de Aplicación Principal (Iframe Impocali)</header>

    <!-- Control de navegación -->
    <div>
        <button onclick="cargarVista('/')">Cliente: Carga de Documentos</button>
        <button onclick="cargarVista('/admin')">Admin: Panel de Solicitudes</button>
        <button onclick="cargarVista('/detalle/1')">Admin: Detalle Solicitud ID 1</button>
    </div>

    <!-- Iframe -->
    <iframe id="autogestionIframe" src="http://localhost:5000/admin" frameborder="0"></iframe>

    <footer>Footer de la Aplicación Principal</footer>

    <script>
        const iframe = document.getElementById('autogestionIframe');

        // Datos quemados para pruebas locales
        const token = "dcc414bd3f1d41f93c26fc7753f3b72b1eda4ef763d4d31d61f49ba8053c1f3f"; // Token quemado
        const id = 123;
        const correo = "usuario@impocali.com";

        /**
         * Guarda los datos de autenticación en localStorage.
         */
        function guardarDatosGlobales() {
            localStorage.setItem("token", token);
            localStorage.setItem("usuario_id", id);
            localStorage.setItem("correo", correo);
        }

        /**
         * Envía los datos al iframe mediante postMessage.
         */
        function enviarPostMessage() {
            const storedToken = localStorage.getItem("token");
            const storedId = localStorage.getItem("usuario_id");
            const storedCorreo = localStorage.getItem("correo");

            if (storedToken && storedId && storedCorreo) {
                iframe.contentWindow.postMessage({ token: storedToken, id: storedId, correo: storedCorreo }, '*');
                console.log("Datos enviados al iframe:", { token: storedToken, id: storedId, correo: storedCorreo });
            } else {
                console.warn("Faltan datos para enviar al iframe.");
            }
        }

        /**
         * Cambia la vista dentro del iframe.
         * @param {string} ruta 
         */
        function cargarVista(ruta) {
            iframe.src = `http://localhost:5000${ruta}`;
            iframe.onload = enviarPostMessage;
        }

        // Inicialización: guardar datos y enviar al iframe
        guardarDatosGlobales();
        iframe.onload = enviarPostMessage;
    </script>

</body>

</html>